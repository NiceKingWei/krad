<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <script type="text/javascript" src="assets/js/phaser.min.js"></script>
  <script type="text/javascript" src="assets/js/CanvasInput.min.js"></script>
  <link href="assets/css/global.css" rel="stylesheet" type="text/css" />
  <script type="text/javascript" src="assets/js/jquery.min.js"></script>
  <link href='https://fonts.googleapis.com/css?family=Indie+Flower' rel='stylesheet' type='text/css'>
</head>
<body>
  
  <script>
    var game = new Phaser.Game(800, 600, Phaser.CANVAS, '', {
      preload: function () {
        game.load.image('background', 'assets/img/userbackground.png');
        game.load.image('userfigure', 'assets/img/figure/figure1.png');
        game.load.image('input', 'assets/img/inputbox1.png', 20, 20);
        game.load.spritesheet('button','assets/buttons/button1.png',100,34);
        game.load.bitmapFont('chiller', 'assets/fonts/chiller.png', 'assets/fonts/chiller.xml');
      },

      create: function () {
        /*var url = winddow.location.href;
        var sid = url.split("?")[1];*/
        var background = game.add.sprite(0, 0, 'background');
        var userfigure = game.add.sprite(10, 10, 'userfigure');
        background.smoothed = true;
        background.height = game.height;
        background.width = game.width;

        var loginText = game.add.bitmapText(350, 130, 'chiller', 'Log In', 70);
        var usernameText = game.add.bitmapText(30, 10, 'chiller', 'zhuchiwei', 54);
        var passwordText = game.add.bitmapText(250, 255, 'chiller', 'Password', 54);

        var signUpButton = game.add.button(270, 320, 'button', do_signup, this, 1, 0, 2, 0);
        var signUpButtonText = game.add.bitmapText(292, 320, 'chiller', 'Sign Up', 28);

        var logInButton = game.add.button(450, 320, 'button', do_login, this, 1, 0, 2, 0);
        var logInButtonText = game.add.bitmapText(475, 322, 'chiller', 'Log In', 28);
      }
    });

    function do_signup() {
        window.location.href = "register.html"
    }

    function do_login() {
      var email = $("#email").val();
      var password = $("#password").val();
      var req = {
        'email': email,
        'password': password
      };
      console.log(req);
      var v_email = /^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/.test(email);
      var v_password = /[a-zA-Z0-9]{6,18}/.test(password);
      if (!v_email || !v_password) {
        alert("邮箱格式或密码格式不正确");
        return;
      }
      $.ajax({
        url: "/api/session/login",
        type: "POST",
        contentType: 'application/json',
        data: JSON.stringify(req),
        success: function (data, status) {
          alert("登录成功");
          console.log(data);
          console.log(data.sid);
          console.log(data.user);
          // window.location.href = ""; //需要跳转的地址
        },
        error: function (data, status) {
          alert("用户名或密码错误");
          console.log(data);
        }
      });
    }
  </script>

</body>

</html>